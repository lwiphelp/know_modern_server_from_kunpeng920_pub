

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-CN" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-CN" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>RoCE接口 &mdash; 从鲲鹏920了解现代服务器实现和应用 0.1a1 文档</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="next" title="虚拟设备" href="虚拟设备.html" />
    <link rel="prev" title="Ethernet接口" href="Ethernet接口.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> 从鲲鹏920了解现代服务器实现和应用
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../序.html">序</a></li>
<li class="toctree-l1"><a class="reference internal" href="../感谢.html">感谢</a></li>
<li class="toctree-l1"><a class="reference internal" href="../认识服务器/index.html">认识服务器</a></li>
<li class="toctree-l1"><a class="reference internal" href="../认识鲲鹏920：一个服务器SoC/index.html">认识鲲鹏920：一个服务器SoC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../计算子系统/index.html">计算子系统</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">网络子系统</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="综述.html">综述</a></li>
<li class="toctree-l2"><a class="reference internal" href="Ethernet接口.html">Ethernet接口</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">RoCE接口</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#rdma">RDMA</a></li>
<li class="toctree-l3"><a class="reference internal" href="#rdma-consortium">RDMA Consortium的基本概念空间</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id1">RoCE的软件支持</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hns3-roce">HNS3 RoCE实现</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="虚拟设备.html">虚拟设备</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../存储子系统/index.html">存储子系统</a></li>
<li class="toctree-l1"><a class="reference internal" href="../RAS设计/index.html">RAS设计</a></li>
<li class="toctree-l1"><a class="reference internal" href="../未来展望.html">未来展望</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">从鲲鹏920了解现代服务器实现和应用</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">网络子系统</a> &raquo;</li>
        
      <li>RoCE接口</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/网络子系统/RoCE接口.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="roce">
<h1>RoCE接口<a class="headerlink" href="#roce" title="永久链接至标题">¶</a></h1>
<div class="section" id="rdma">
<h2>RDMA<a class="headerlink" href="#rdma" title="永久链接至标题">¶</a></h2>
<p>RoCE是RDMA over Converged Ethernet的缩写，RDMA这个概念最早来自什么多个解决方案
，是谁先提出来的已经不容易确定了，我们也不关心这种复杂的历史发展过程，我们把关
注点放在这个特性的本质和在服务器领域的重要性上。</p>
<p>内存共享是分布式计算一个很关键的问题，如果计算节点比较近，我们可以直接基于总线
协议进行统一的内存共享，这是常见的SMP系统的解决方案。但如果总线的规模变大，很
多常见的总线访问接口就显得不合适了。比如说，一般的总线语义是不会认为某个访问对
象是会断开的，但如果通讯的规模变大，好比说，有十万个CPU，这些硬件就可能跨越很
多个机框、机架、甚至机房。这样就很难要求总线的节点都不会断开。这时，其实总线就
会接近于网络。</p>
<p>但专用的并行计算网络确实又不同于互联网，它不会经过复杂的，不可预测的公共网络，
轻易不会丢包。这样，一种中间的，比互联网可靠，但比总线稍差的互联需求就提出来了
。这催生了RDMA。</p>
<p>RDMA，Remote DMA本质上就是对着总线的DMA去的，它提供把一个节点的内存，同步到另
一个节点去的能力，同时，假设了这个同步过程是比本地总线拷贝慢的，可失败的，并且
很可能独立编址的。</p>
<p>RDMA有很多的实现方法和接口，但有一个影响比较大的标准组织：:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">rdmaconsortium</span><span class="o">.</span><span class="n">org</span><span class="o">/</span>
</pre></div>
</div>
<p>为RDMA定义了很多基本的概念、原语和实现方法，成为很多RDMA方案的基础，其中包括我
们这里要介绍的RoCE协议。</p>
<p>RDMA Consortium的方案广泛用于各种数据中心，比如很多远程存储设备就使用RoCE接口
提供远程存储支持，……todo：需要更多例子细节。</p>
<p>todo：RoCE协议介绍。这样重点在于，RoCE和网络通讯的区别在于，RoCE的消息是直接写
到用户态需要的内存去的，而网络通讯是直接写到skb里面，要进一步的拷贝才能到用户
态。</p>
<p>todo：存储的使用场景要收集进来。</p>
</div>
<div class="section" id="rdma-consortium">
<h2>RDMA Consortium的基本概念空间<a class="headerlink" href="#rdma-consortium" title="永久链接至标题">¶</a></h2>
<p>todo：下面的逻辑是先堆上来，后面需要重新整理：</p>
<p>RDMA Consortium定义了一组实现无关的原语（Verb），基于这组原语，可以有不同的通
讯层和实现。</p>
<p>RDMA Constortium原语的使用者通过Queue Pair收发原语，Queue Pair是一对Queue，包
括一个Send Queue和一个Receive Queue（或者Share Receive Queue），还有一个辅助性
的Complete Queue。发出的原语称为Work Request，WR写到QP中，称为一个WQE，Work
Queue Element。Work Request发到Queue里面称为一个Workd Queue Element。</p>
<p>RDMA Constortium原语包括三类：</p>
<ul class="simple">
<li>收发：Send （可选SE和Invalidate），Receive</li>
<li>RDMA：Read（可选Invalidate），Write</li>
<li>Memory：Bind，Fast Register MR，Invalidate Locale STag</li>
</ul>
<p>这个原语包括如下基本概念：</p>
<ul class="simple">
<li>MR, Memory Registration</li>
<li>MW, Memory Window</li>
<li>……</li>
</ul>
</div>
<div class="section" id="id1">
<h2>RoCE的软件支持<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h2>
<p>todo: RoCE用户态库OFED主线的位置和维护情况。</p>
</div>
<div class="section" id="hns3-roce">
<h2>HNS3 RoCE实现<a class="headerlink" href="#hns3-roce" title="永久链接至标题">¶</a></h2>
<p>todo</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="虚拟设备.html" class="btn btn-neutral float-right" title="虚拟设备" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Ethernet接口.html" class="btn btn-neutral float-left" title="Ethernet接口" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Kenneth Lee

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>